---
description:
globs:
alwaysApply: false
---
# å¼€å‘å·¥ä½œæµç¨‹è§„èŒƒ

## Git å·¥ä½œæµç¨‹

### åˆ†æ”¯ç­–ç•¥
é‡‡ç”¨ Git Flow ç®€åŒ–ç‰ˆæœ¬ï¼Œé€‚åˆä¸­å°å‹é¡¹ç›®ï¼š

**ä¸»è¦åˆ†æ”¯ï¼š**
- `main` - ä¸»åˆ†æ”¯ï¼Œä¿æŒç¨³å®šå¯å‘å¸ƒçŠ¶æ€
- `develop` - å¼€å‘åˆ†æ”¯ï¼Œé›†æˆæ‰€æœ‰åŠŸèƒ½å¼€å‘

**è¾…åŠ©åˆ†æ”¯ï¼š**
- `feature/*` - åŠŸèƒ½å¼€å‘åˆ†æ”¯
- `hotfix/*` - ç´§æ€¥ä¿®å¤åˆ†æ”¯
- `release/*` - å‘å¸ƒå‡†å¤‡åˆ†æ”¯

### åˆ†æ”¯å‘½åè§„èŒƒ
```bash
# åŠŸèƒ½å¼€å‘åˆ†æ”¯
feature/user-authentication
feature/payment-integration
feature/dashboard-redesign

# ä¿®å¤åˆ†æ”¯
hotfix/critical-security-fix
hotfix/payment-error-fix

# å‘å¸ƒåˆ†æ”¯
release/v1.2.0
release/v2.0.0-beta
```

### æ ‡å‡†å¼€å‘æµç¨‹

#### 1. åŠŸèƒ½å¼€å‘æµç¨‹
```bash
# 1. ä»developåˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout develop
git pull origin develop
git checkout -b feature/user-authentication

# 2. å¼€å‘è¿‡ç¨‹ä¸­å®šæœŸæäº¤
git add .
git commit -m "feat: æ·»åŠ ç”¨æˆ·ç™»å½•éªŒè¯é€»è¾‘"

# 3. å®šæœŸåŒæ­¥developåˆ†æ”¯çš„æ›´æ–°
git checkout develop
git pull origin develop
git checkout feature/user-authentication
git rebase develop

# 4. å¼€å‘å®Œæˆåæ¨é€åˆ†æ”¯
git push origin feature/user-authentication

# 5. åˆ›å»º Pull Request
# åœ¨ GitHub/GitLab ä¸Šåˆ›å»º PRï¼Œè¯·æ±‚åˆå¹¶åˆ° develop

# 6. ä»£ç å®¡æŸ¥é€šè¿‡ååˆå¹¶
git checkout develop
git pull origin develop
git branch -d feature/user-authentication
```

#### 2. å‘å¸ƒæµç¨‹
```bash
# 1. ä»developåˆ›å»ºå‘å¸ƒåˆ†æ”¯
git checkout develop
git pull origin develop
git checkout -b release/v1.2.0

# 2. å‘å¸ƒå‡†å¤‡ï¼ˆç‰ˆæœ¬å·æ›´æ–°ã€æ–‡æ¡£æ›´æ–°ç­‰ï¼‰
npm version minor  # æ›´æ–°package.jsonç‰ˆæœ¬å·
git add .
git commit -m "chore: å‡†å¤‡å‘å¸ƒ v1.2.0"

# 3. åˆå¹¶åˆ°mainåˆ†æ”¯
git checkout main
git pull origin main
git merge release/v1.2.0
git tag v1.2.0
git push origin main --tags

# 4. åˆå¹¶å›developåˆ†æ”¯
git checkout develop
git merge release/v1.2.0
git push origin develop

# 5. åˆ é™¤å‘å¸ƒåˆ†æ”¯
git branch -d release/v1.2.0
git push origin --delete release/v1.2.0
```

#### 3. ç´§æ€¥ä¿®å¤æµç¨‹
```bash
# 1. ä»mainåˆ†æ”¯åˆ›å»ºä¿®å¤åˆ†æ”¯
git checkout main
git pull origin main
git checkout -b hotfix/critical-security-fix

# 2. å¿«é€Ÿä¿®å¤
git add .
git commit -m "fix: ä¿®å¤å…³é”®å®‰å…¨æ¼æ´"

# 3. åˆå¹¶åˆ°mainå¹¶å‘å¸ƒ
git checkout main
git merge hotfix/critical-security-fix
git tag v1.2.1
git push origin main --tags

# 4. åˆå¹¶å›develop
git checkout develop
git merge hotfix/critical-security-fix
git push origin develop

# 5. æ¸…ç†
git branch -d hotfix/critical-security-fix
```

## æäº¤ä¿¡æ¯è§„èŒƒ

### Conventional Commits æ ¼å¼
```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

### æäº¤ç±»å‹è¯´æ˜
- `feat`: æ–°åŠŸèƒ½
- `fix`: é”™è¯¯ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: ä»£ç é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bugï¼‰
- `test`: æ·»åŠ æˆ–ä¿®æ”¹æµ‹è¯•
- `chore`: æ‚åŠ¡ä»»åŠ¡ï¼ˆæ„å»ºã€å·¥å…·é…ç½®ç­‰ï¼‰
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `ci`: CI/CDç›¸å…³ä¿®æ”¹

### æäº¤ä¿¡æ¯ç¤ºä¾‹
```bash
# å¥½çš„æäº¤ä¿¡æ¯
git commit -m "feat(auth): æ·»åŠ OAuth2.0ç¤¾äº¤ç™»å½•æ”¯æŒ"
git commit -m "fix(payment): ä¿®å¤æ”¯ä»˜é‡‘é¢è®¡ç®—ç²¾åº¦é—®é¢˜"
git commit -m "docs: æ›´æ–°APIæ–‡æ¡£çš„è®¤è¯éƒ¨åˆ†"
git commit -m "test(user): æ·»åŠ ç”¨æˆ·æ³¨å†Œæµç¨‹çš„é›†æˆæµ‹è¯•"

# è¯¦ç»†æäº¤ä¿¡æ¯
git commit -m "feat(dashboard): æ·»åŠ å®æ—¶æ•°æ®å›¾è¡¨ç»„ä»¶

- é›†æˆChart.jsåº“ç”¨äºæ•°æ®å¯è§†åŒ–
- æ”¯æŒæŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€é¥¼å›¾ä¸‰ç§ç±»å‹
- æ·»åŠ å›¾è¡¨æ•°æ®åˆ·æ–°å’Œå¯¼å‡ºåŠŸèƒ½
- ä¼˜åŒ–ç§»åŠ¨ç«¯å“åº”å¼æ˜¾ç¤º

Closes #123"
```

## ä»£ç å®¡æŸ¥è§„èŒƒ

### Pull Request è§„èŒƒ

#### PR æ ‡é¢˜æ ¼å¼
```
<type>: <description>

# ç¤ºä¾‹
feat: æ·»åŠ ç”¨æˆ·ä¸ªäººèµ„æ–™ç¼–è¾‘åŠŸèƒ½
fix: ä¿®å¤è´­ç‰©è½¦æ•°é‡è®¡ç®—é”™è¯¯
refactor: é‡æ„ç”¨æˆ·æƒé™éªŒè¯é€»è¾‘
```

#### PR æè¿°æ¨¡æ¿
```markdown
## ğŸ“‹ å˜æ›´æè¿°
ç®€è¦æè¿°æœ¬æ¬¡å˜æ›´çš„å†…å®¹å’Œç›®çš„

## ğŸ”§ å˜æ›´ç±»å‹
- [ ] æ–°åŠŸèƒ½ (feature)
- [ ] é”™è¯¯ä¿®å¤ (bug fix)
- [ ] ä»£ç é‡æ„ (refactoring)
- [ ] æ–‡æ¡£æ›´æ–° (documentation)
- [ ] æ€§èƒ½ä¼˜åŒ– (performance)
- [ ] æµ‹è¯•ç›¸å…³ (test)

## ğŸ“Š å½±å“èŒƒå›´
- [ ] å‰ç«¯ç•Œé¢
- [ ] åç«¯API
- [ ] æ•°æ®åº“ç»“æ„
- [ ] ç¬¬ä¸‰æ–¹é›†æˆ
- [ ] é…ç½®æ–‡ä»¶

## ğŸ§ª æµ‹è¯•æƒ…å†µ
- [ ] å•å…ƒæµ‹è¯•å·²é€šè¿‡
- [ ] é›†æˆæµ‹è¯•å·²é€šè¿‡
- [ ] æ‰‹åŠ¨æµ‹è¯•å·²å®Œæˆ
- [ ] å›å½’æµ‹è¯•æ— é—®é¢˜

## ğŸ“¸ æˆªå›¾/æ¼”ç¤º
å¦‚æœæ˜¯UIç›¸å…³å˜æ›´ï¼Œè¯·é™„ä¸Šæˆªå›¾æˆ–GIFæ¼”ç¤º

## ğŸ”— ç›¸å…³Issue
Closes #issue_number

## ğŸ“ é™„åŠ ä¿¡æ¯
å…¶ä»–éœ€è¦è¯´æ˜çš„ä¿¡æ¯
```

### ä»£ç å®¡æŸ¥æ¸…å•

#### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] ä»£ç é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£
- [ ] å˜é‡å’Œå‡½æ•°å‘½åæœ‰æ„ä¹‰
- [ ] æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½é—®é¢˜
- [ ] é”™è¯¯å¤„ç†é€‚å½“
- [ ] å®‰å…¨æ€§è€ƒè™‘å……åˆ†

#### æŠ€æœ¯è§„èŒƒæ£€æŸ¥
- [ ] ç¬¦åˆé¡¹ç›®ä»£ç é£æ ¼
- [ ] TypeScriptç±»å‹å®šä¹‰å®Œæ•´
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–å……åˆ†
- [ ] æ–‡æ¡£å’Œæ³¨é‡Šæ¸…æ™°
- [ ] æ²¡æœ‰ä»£ç é‡å¤

#### ä¸šåŠ¡é€»è¾‘æ£€æŸ¥
- [ ] åŠŸèƒ½å®ç°ç¬¦åˆéœ€æ±‚
- [ ] è¾¹ç•Œæƒ…å†µå¤„ç†æ­£ç¡®
- [ ] ç”¨æˆ·ä½“éªŒè‰¯å¥½
- [ ] å‘åå…¼å®¹æ€§è€ƒè™‘

## CI/CD æµæ°´çº¿

### GitHub Actions é…ç½®

#### æŒç»­é›†æˆæµæ°´çº¿
```yaml
# .github/workflows/ci.yml
name: Continuous Integration

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18, 20]
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Lint code
        run: npm run lint

      - name: Type check
        run: npm run type-check

      - name: Run tests
        run: npm run test:coverage

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info

  build:
    runs-on: ubuntu-latest
    needs: test
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build project
        run: npm run build

      - name: Archive build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: build-files
          path: dist/
```

#### æŒç»­éƒ¨ç½²æµæ°´çº¿
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    tags:
      - 'v*'

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run tests
        run: npm test

      - name: Build project
        run: npm run build

      - name: Deploy to production
        run: npm run deploy
        env:
          DEPLOY_TOKEN: ${{ secrets.DEPLOY_TOKEN }}

      - name: Create GitHub Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref }}
          release_name: Release ${{ github.ref }}
          draft: false
          prerelease: false
```

### è‡ªåŠ¨åŒ–æµ‹è¯•ç­–ç•¥

#### æµ‹è¯•é‡‘å­—å¡”
```
    /\        E2E Tests (å°‘é‡ï¼Œæ…¢é€Ÿï¼Œæ˜‚è´µ)
   /  \       - å…³é”®ç”¨æˆ·æµç¨‹
  /____\      - è·¨æµè§ˆå™¨å…¼å®¹æ€§
 /      \     
/________\    Integration Tests (é€‚ä¸­)
/          \  - APIé›†æˆæµ‹è¯•
/____________\ - ç»„ä»¶é›†æˆæµ‹è¯•

   Unit Tests (å¤§é‡ï¼Œå¿«é€Ÿï¼Œä¾¿å®œ)
   - çº¯å‡½æ•°æµ‹è¯•
   - ç»„ä»¶å•å…ƒæµ‹è¯•
   - å·¥å…·å‡½æ•°æµ‹è¯•
```

#### æµ‹è¯•é…ç½®
```json
// package.json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:e2e": "playwright test",
    "test:integration": "jest --config jest.integration.config.js"
  }
}
```

## ä»£ç è´¨é‡æ§åˆ¶

### ESLint é…ç½®
```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'prettier'
  ],
  rules: {
    'no-console': 'warn',
    'no-debugger': 'error',
    'prefer-const': 'error',
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/explicit-function-return-type': 'warn'
  }
};
```

### Prettier é…ç½®
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false
}
```

### Husky Git Hooks
```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS",
      "pre-push": "npm test"
    }
  },
  "lint-staged": {
    "*.{ts,tsx,js,jsx}": [
      "eslint --fix",
      "prettier --write",
      "git add"
    ],
    "*.{json,md,yml}": [
      "prettier --write",
      "git add"
    ]
  }
}
```

## ç¯å¢ƒç®¡ç†

### å¤šç¯å¢ƒé…ç½®
```
# ç¯å¢ƒå±‚çº§
development   # å¼€å‘ç¯å¢ƒ
staging      # é¢„å‘å¸ƒç¯å¢ƒ  
production   # ç”Ÿäº§ç¯å¢ƒ
```

### ç¯å¢ƒå˜é‡ç®¡ç†
```bash
# .env.development
NODE_ENV=development
API_BASE_URL=http://localhost:3001/api
DATABASE_URL=postgresql://localhost/myapp_dev
LOG_LEVEL=debug

# .env.staging
NODE_ENV=staging
API_BASE_URL=https://api-staging.example.com
DATABASE_URL=postgresql://staging-db/myapp
LOG_LEVEL=info

# .env.production
NODE_ENV=production
API_BASE_URL=https://api.example.com
DATABASE_URL=postgresql://prod-db/myapp
LOG_LEVEL=error
```

### éƒ¨ç½²é…ç½®
```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
    depends_on:
      - db

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=myapp
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

## å‘å¸ƒç®¡ç†

### è¯­ä¹‰åŒ–ç‰ˆæœ¬
éµå¾ª [Semantic Versioning](https://semver.org/) è§„èŒƒï¼š

- **MAJOR** (ä¸»ç‰ˆæœ¬å·): ä¸å…¼å®¹çš„APIå˜æ›´
- **MINOR** (æ¬¡ç‰ˆæœ¬å·): å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **PATCH** (ä¿®è®¢å·): å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

```bash
# ç‰ˆæœ¬æ›´æ–°ç¤ºä¾‹
npm version patch   # 1.0.0 -> 1.0.1 (bugä¿®å¤)
npm version minor   # 1.0.1 -> 1.1.0 (æ–°åŠŸèƒ½)
npm version major   # 1.1.0 -> 2.0.0 (ç ´åæ€§å˜æ›´)

# é¢„å‘å¸ƒç‰ˆæœ¬
npm version prerelease         # 1.0.0 -> 1.0.1-0
npm version prerelease --preid=beta  # 1.0.0 -> 1.0.1-beta.0
```

### å˜æ›´æ—¥å¿—
ç»´æŠ¤ `CHANGELOG.md` æ–‡ä»¶ï¼Œè®°å½•ç‰ˆæœ¬å˜æ›´ï¼š

```markdown
# æ›´æ–°æ—¥å¿—

## [Unreleased]

## [1.2.0] - 2023-12-01
### æ–°å¢
- æ·»åŠ ç”¨æˆ·å¤´åƒä¸Šä¼ åŠŸèƒ½
- æ”¯æŒå¤šè¯­è¨€å›½é™…åŒ–

### ä¿®æ”¹  
- ä¼˜åŒ–ç™»å½•é¡µé¢UIè®¾è®¡
- æ›´æ–°APIå“åº”æ ¼å¼

### ä¿®å¤
- ä¿®å¤ç§»åŠ¨ç«¯å¸ƒå±€é—®é¢˜
- è§£å†³å†…å­˜æ³„æ¼é—®é¢˜

### ç§»é™¤
- ç§»é™¤åºŸå¼ƒçš„æ—§ç‰ˆAPI

## [1.1.0] - 2023-11-15
### æ–°å¢
- æ·»åŠ ç”¨æˆ·æƒé™ç®¡ç†
- é›†æˆç¬¬ä¸‰æ–¹æ”¯ä»˜
```

### å‘å¸ƒæ£€æŸ¥æ¸…å•

#### å‘å¸ƒå‰æ£€æŸ¥
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] æ–‡æ¡£æ›´æ–°å®Œæ•´
- [ ] ç‰ˆæœ¬å·æ­£ç¡®æ›´æ–°
- [ ] å˜æ›´æ—¥å¿—å·²æ›´æ–°
- [ ] ä¾èµ–å®‰å…¨æ£€æŸ¥é€šè¿‡

#### å‘å¸ƒåéªŒè¯
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æˆåŠŸ
- [ ] å…³é”®åŠŸèƒ½éªŒè¯æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡æ— å¼‚å¸¸
- [ ] é”™è¯¯æ—¥å¿—ç›‘æ§æ­£å¸¸
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†æœºåˆ¶æ­£å¸¸

## ç›‘æ§å’Œåé¦ˆ

### é”™è¯¯ç›‘æ§
```typescript
// é”™è¯¯ä¸ŠæŠ¥é…ç½®
interface ErrorReport {
  message: string;
  stack?: string;
  url: string;
  userAgent: string;
  userId?: string;
  timestamp: number;
  metadata?: Record<string, any>;
}

class ErrorReporter {
  static report(error: Error, metadata?: Record<string, any>) {
    const report: ErrorReport = {
      message: error.message,
      stack: error.stack,
      url: window.location.href,
      userAgent: navigator.userAgent,
      timestamp: Date.now(),
      metadata
    };

    // å‘é€åˆ°ç›‘æ§æœåŠ¡
    fetch('/api/errors', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(report)
    });
  }
}

// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('error', (event) => {
  ErrorReporter.report(event.error);
});

window.addEventListener('unhandledrejection', (event) => {
  ErrorReporter.report(new Error(event.reason));
});
```

### æ€§èƒ½ç›‘æ§
```typescript
// æ€§èƒ½æŒ‡æ ‡æ”¶é›†
interface PerformanceMetrics {
  pageLoadTime: number;
  domContentLoaded: number;
  firstContentfulPaint: number;
  largestContentfulPaint: number;
  cumulativeLayoutShift: number;
}

class PerformanceMonitor {
  static collect(): PerformanceMetrics {
    const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;
    
    return {
      pageLoadTime: navigation.loadEventEnd - navigation.navigationStart,
      domContentLoaded: navigation.domContentLoadedEventEnd - navigation.navigationStart,
      firstContentfulPaint: this.getFCP(),
      largestContentfulPaint: this.getLCP(),
      cumulativeLayoutShift: this.getCLS()
    };
  }

  private static getFCP(): number {
    const entries = performance.getEntriesByName('first-contentful-paint');
    return entries.length > 0 ? entries[0].startTime : 0;
  }

  private static getLCP(): number {
    // å®ç°LCPæµ‹é‡é€»è¾‘
    return 0;
  }

  private static getCLS(): number {
    // å®ç°CLSæµ‹é‡é€»è¾‘
    return 0;
  }
}
```

é€šè¿‡éµå¾ªè¿™äº›å¼€å‘å·¥ä½œæµç¨‹è§„èŒƒï¼Œå›¢é˜Ÿå¯ä»¥å»ºç«‹é«˜æ•ˆã€å¯é çš„å¼€å‘æµç¨‹ï¼Œç¡®ä¿ä»£ç è´¨é‡å’Œé¡¹ç›®çš„é•¿æœŸç»´æŠ¤æ€§ã€‚æ ¹æ®å›¢é˜Ÿè§„æ¨¡å’Œé¡¹ç›®ç‰¹ç‚¹ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´å…·ä½“çš„æµç¨‹å’Œå·¥å…·é…ç½®ã€‚
